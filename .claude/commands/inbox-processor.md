# Inbox Processor - 收件箱处理器

智能分析收件箱内容，提供整理建议，帮助定期清空收件箱。

## 工作流程

### 1. 扫描收件箱

使用 Glob 和 Read 工具：
```
扫描 00_Inbox/*.md
排除 README.md
按创建时间排序
```

统计并展示：
```
📥 收件箱包含 X 个未处理项目

[按类型统计]
- Idea: 5
- Todo: 3
- Question: 2
- Note: 1
```

### 2. 逐个分析

对每个文件：

**读取内容**：
- Front Matter 元数据
- 标题和正文
- 标签和类型

**智能分析**：
- 识别主题和关键词
- 判断紧急程度
- 检测与已有项目/领域的关联

**生成建议**：

| 类型 | 建议目标 | 判断依据 |
|------|---------|---------|
| idea + 具体项目 | `01_Projects/[ProjectName]/` | 内容详细，可执行 |
| idea + 持续主题 | `02_Areas/[AreaName]/` | 属于某个责任领域 |
| reference | `03_Resources/[Category]/` | 参考性质 |
| todo + 已有项目 | 移动到项目并提取行动项 | 关联明确 |
| question + 需探索 | 保留，建议使用 `/thinking-partner` | 值得深入思考 |
| 不再相关 | `04_Archive/` | 过时或放弃 |

**模板优先规则（新建目标）**：
- 当建议目标为“新建目录”（Projects/Areas/Resources 等），先检查目标区域内的 `_template/`
- 若目标区域无模板或不匹配，再从 `06_Meta/Templates/` 选择合适模板
- 若仍不匹配或用户希望自定义，允许用户指定模板路径或跳过模板创建

**Front Matter 统一规则（迁移时必须遵守）**：
- Front Matter 是唯一元信息来源，正文不重复写状态/日期/标签等元信息
- 以目标模板的 Front Matter 为基底合并 Inbox 的 Front Matter
- `created` 保留原值，`updated` 设为处理时间
- `tags` 合并去重
- `status` 按目标类型设置（项目: `planning`，领域: `active`，资源: `active`，归档: `archived`）

### 3. 展示建议

格式化显示每个项目：

```
[1] 2024-01-10-react-hooks-article.md
    类型: idea
    标签: #article #react #hooks

    内容预览:
    "写一篇关于 React Hooks 最佳实践的深度文章..."

    💡 建议: 移动到 01_Projects/React-Hooks-Tutorial/
    理由: 这是一个明确的写作项目，有具体目标

    相关内容:
    - 找到 [[API-Design-Patterns]] 中提到过类似主题
    - 02_Areas/Writing/ 领域可能需要更新

[2] 2024-01-09-meeting-notes.md
    类型: note
    标签: #meeting

    内容预览:
    "团队会议讨论新功能规划..."

    💡 建议: 提取行动项 + 归档原文
    理由: 会议笔记应提取可执行任务

    检测到的行动项:
    - [ ] 完成 API 设计文档 (@你)
    - [ ] 准备演示 Demo (@张三)
```

### 4. 处理选项

询问处理方式：

```
处理方式:
[1] 逐个确认（推荐） - 我会逐个询问每项的处理方式
[2] 批量应用建议 - 自动应用所有建议
[3] 仅显示概览 - 只看统计，稍后手动处理
[4] 退出
```

**逐个处理**：
```
[1/5] react-hooks-article.md

建议: 移动到 01_Projects/React-Hooks-Tutorial/

选择操作:
[M] 移动到建议位置（如为新项目，先按模板创建）
[E] 编辑后再决定
[D] 删除/归档
[S] 跳过（保留在收件箱）
[T] 使用 /thinking-partner 深入思考
[C] 自定义位置

> _
```

**批量处理**：
```
应用所有建议？这将：
- 移动 3 个文件到项目
- 提取 2 个会议笔记的行动项
- 归档 1 个过时内容

确认？[Y/n]
```

### 5. 执行操作

根据用户选择执行：

**移动文件**：
- 使用 Bash `mv` 命令
- 合并并更新 Front Matter（遵循统一规则），不要把元信息写入正文
- 如果目标是新建目录（Projects/Areas/Resources 等）：
  - 先从目标区域 `_template/` 复制模板到新目录
  - 若模板缺失或用户指定，从 `06_Meta/Templates/` 复制合适模板
  - 询问是否需要将收件箱正文补充进目标主文档（不包含 Front Matter）

**提取行动项**：
- 读取内容，识别任务
- 在目标项目中添加任务列表
- 原文件归档或删除

**归档**：
- 移动到 `04_Archive/YYYY/MM/`
- 更新状态

### 6. 完成总结

处理完成后显示：

```
✅ 收件箱处理完成！

处理结果:
- 移动到项目: 3 个
- 移动到领域: 1 个
- 移动到资源: 1 个
- 归档: 2 个
- 保留: 1 个（需要进一步思考）

当前收件箱: 1 个未处理项目

建议:
- 对保留的项目使用 /thinking-partner 深入探索
- 检查更新的项目是否需要调整计划
```

## 行为准则

### 必须做 ✓

- ✓ 提供清晰的分类建议和理由
- ✓ 检测内容与已有笔记的关联
- ✓ 尊重用户决策，提供灵活选项
- ✓ 执行操作后更新元数据

### 禁止做 ✗

- ✗ 不要在未经确认的情况下删除文件
- ✗ 不要批量处理时跳过重要内容
- ✗ 不要忽略用户的历史分类习惯

## 智能功能

### 检测关联

搜索工作区中的关联内容：
- 相似关键词的笔记
- 提到相同项目的文件
- 相同标签的内容

### 学习用户习惯

观察用户的整理模式：
- 特定类型内容的目标位置
- 常用的标签组合
- 项目命名习惯

### 批处理优化

识别可以批量处理的内容：
```
检测到 3 个关于 "React" 的想法，建议:
[1] 批量移动到 01_Projects/React-Learning/
[2] 分别处理
```

## 记住

收件箱处理的目标是**将想法转化为行动**。帮助用户：
- 快速决策每个项目的去向
- 发现被遗忘的好想法
- 保持收件箱清空的状态
